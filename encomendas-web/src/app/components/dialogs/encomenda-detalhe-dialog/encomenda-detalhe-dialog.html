<h1 mat-dialog-title>Detalhes da Encomenda</h1>
<button mat-icon-button (click)="onClose()" class="close-button" aria-label="Fechar diálogo">
  <mat-icon>close</mat-icon>
</button>

<mat-dialog-content>

  <mat-card appearance="outlined" class="info-card">
    <mat-card-content>

      <div class="info-row" style="align-items: flex-start;">
        <mat-icon style="margin-top: 2px;">person</mat-icon>
        <div style="display: flex; flex-direction: column;">
          <span><strong>Cliente:</strong> {{encomenda.cliente.nome}}</span>
          <span *ngIf="encomenda.cliente.email" style="font-size: 0.85rem; color: #666;">
            {{encomenda.cliente.email}}
          </span>
          <span *ngIf="encomenda.cliente.telefone" style="font-size: 0.85rem; color: #666;">
            {{encomenda.cliente.telefone}}
          </span>
        </div>
      </div>

      <div class="info-row">
        <mat-icon>calendar_today</mat-icon>
        <span><strong>Data:</strong> {{encomenda.dataCriacao | date:'dd/MM/yyyy HH:mm'}}</span>
      </div>

      <div class="info-row">
        <mat-icon>location_on</mat-icon>
        <span style="line-height: 1.4;">
          <strong>Entrega:</strong><br>
          {{encomenda.enderecoRua}}, {{encomenda.enderecoNumero}} - {{encomenda.enderecoComplemento}}<br>
          {{encomenda.enderecoBairro}} - CEP: {{encomenda.enderecoCep}}
        </span>
      </div>

      <div class="info-row">
        <mat-icon>info</mat-icon>
        <span><strong>Status:</strong>
          <mat-chip [color]="getStatusColor(encomenda.status)"
                    [ngClass]="{'chip-cancelado': encomenda.status === 'Cancelado'}"
                    selected>
            {{encomenda.status}}
          </mat-chip>
        </span>
      </div>
      <div class="info-row" *ngIf="encomenda.observacoes">
        <mat-icon>notes</mat-icon>
        <span><strong>Observações:</strong> {{encomenda.observacoes}}</span>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-divider style="margin: 16px 0;"></mat-divider>

  <h3>Itens da Encomenda</h3>
  <mat-list role="list">
    <div *ngFor="let item of encomenda.itens">
      <mat-list-item role="listitem" class="item-list-item">
        <mat-icon matListItemIcon>inventory_2</mat-icon>

        <div matListItemTitle class="item-title-line">
          <span>{{item.produto.nome}}</span>
          <span class="item-subtotal">
            {{item.subtotal | currency:'BRL'}}
          </span>
        </div>

        <div matListItemLine class="item-detail-line">
          <span>
            {{item.quantidade}}x
            <strong class="preco-cotado">{{item.precoCotado | currency:'BRL'}}</strong>
            (Base: {{item.produto.precoBase | currency:'BRL'}})
          </span>
          <span class="item-fornecedor">
            <mat-icon>local_shipping</mat-icon>
            {{item.fornecedor.nome}}
          </span>
        </div>
      </mat-list-item>
      <mat-divider></mat-divider>
    </div>
  </mat-list>

  <div class="total-summary" style="margin-top: 20px; text-align: right;">
    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px;">
      <span style="font-size: 1.1rem; font-weight: 500;">Total da Encomenda:</span>
      <span style="font-size: 1.1rem; font-weight: bold;">{{encomenda.valorTotal | currency:'BRL'}}</span>
    </div>

    <div *ngIf="encomenda.valorAdiantamento && encomenda.valorAdiantamento > 0" style="margin-top: 8px;">
      <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; color: #2e7d32;">
        <span style="font-size: 1rem;">Adiantamento Pago:</span>
        <span style="font-size: 1rem; font-weight: bold;">- {{encomenda.valorAdiantamento | currency:'BRL'}}</span>
      </div>
      <mat-divider style="margin: 8px 0; margin-left: auto; width: 50%;"></mat-divider>
      <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; color: #d32f2f;">
        <span style="font-size: 1.2rem; font-weight: 500;">Restante a Pagar:</span>
        <span style="font-size: 1.4rem; font-weight: bold;">
          {{ (encomenda.valorTotal - encomenda.valorAdiantamento) | currency:'BRL' }}
        </span>
      </div>
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button color="primary" (click)="gerarPDF()" style="margin-right: 8px;">
    <mat-icon>picture_as_pdf</mat-icon>
    Gerar PDF
  </button>

  <button mat-flat-button color="primary" (click)="onClose()">Fechar</button>
</mat-dialog-actions>
