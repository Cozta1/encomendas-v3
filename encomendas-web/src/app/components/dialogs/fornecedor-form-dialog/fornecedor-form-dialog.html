<h2 mat-dialog-title>{{ isEditMode ? 'Editar Fornecedor' : 'Novo Fornecedor' }}</h2>

<mat-dialog-content>
  <form [formGroup]="form" class="form-container">

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Razão Social / Nome</mat-label>
      <input matInput formControlName="nome" placeholder="Ex: Distribuidora XYZ" required>
      <mat-error *ngIf="form.get('nome')?.hasError('required')">Nome é obrigatório</mat-error>
    </mat-form-field>

    <div class="row">
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>CNPJ</mat-label>
        <input matInput formControlName="cnpj" placeholder="00.000.000/0000-00" appCnpjMask maxlength="18" required>
        <mat-error *ngIf="form.get('cnpj')?.hasError('required')">CNPJ é obrigatório</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Telefone</mat-label>
        <input matInput formControlName="telefone" placeholder="(00) 00000-0000" appPhoneMask maxlength="15" required>
        <mat-error *ngIf="form.get('telefone')?.hasError('required')">Telefone é obrigatório</mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>E-mail Comercial</mat-label>
      <input matInput formControlName="email" type="email" placeholder="contato@empresa.com" required>
      <mat-error *ngIf="form.get('email')?.hasError('email')">E-mail inválido</mat-error>
      <mat-error *ngIf="form.get('email')?.hasError('required')">E-mail é obrigatório</mat-error>
    </mat-form-field>

    <div class="enderecos-header" style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; margin-bottom: 8px;">
      <h3 style="margin: 0;">Endereços</h3>
      <button mat-stroked-button color="primary" type="button" (click)="adicionarEndereco()">
        <mat-icon>add_location</mat-icon> Adicionar Endereço
      </button>
    </div>

    <div formArrayName="enderecos">
      <mat-accordion multi>
        <mat-expansion-panel *ngFor="let endGroup of enderecosFormArray.controls; let i = index" [formGroupName]="i" expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon style="margin-right: 8px;">business</mat-icon>
              Endereço {{i + 1}}
            </mat-panel-title>
            <mat-panel-description>
              {{ endGroup.get('rua')?.value || 'Novo Endereço' }}
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div class="endereco-form-row" style="display: flex; gap: 10px;">
            <mat-form-field appearance="outline" style="flex: 1;">
              <mat-label>CEP</mat-label>
              <input matInput formControlName="cep" placeholder="00000-000" required appCepMask maxlength="9">
            </mat-form-field>

            <mat-form-field appearance="outline" style="flex: 2;">
              <mat-label>Bairro</mat-label>
              <input matInput formControlName="bairro" required>
            </mat-form-field>
          </div>

          <div class="endereco-form-row" style="display: flex; gap: 10px;">
            <mat-form-field appearance="outline" style="flex: 3;">
              <mat-label>Rua</mat-label>
              <input matInput formControlName="rua" required>
            </mat-form-field>

            <mat-form-field appearance="outline" style="flex: 1;">
              <mat-label>Número</mat-label>
              <input matInput formControlName="numero" required maxlength="10">
            </mat-form-field>
          </div>

          <div class="endereco-form-row" style="display: flex; gap: 10px;">
            <mat-form-field appearance="outline" style="flex: 2;">
              <mat-label>Complemento</mat-label>
              <input matInput formControlName="complemento">
            </mat-form-field>

            <div style="display: flex; align-items: center;">
              <button mat-icon-button color="warn" type="button" matTooltip="Remover este endereço" (click)="removerEndereco(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

        </mat-expansion-panel>
      </mat-accordion>
    </div>

  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button mat-flat-button color="primary" (click)="onSave()" [disabled]="form.invalid">Salvar</button>
</mat-dialog-actions>
