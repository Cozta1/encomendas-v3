<div class="board-wrapper">

  <div class="page-header">
    <h1>Meu Dia</h1>

    <div class="date-nav">
      <button mat-icon-button (click)="diaAnterior()" matTooltip="Dia anterior">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <div class="date-display">
        <p class="data-hoje">{{ dataAtual | date:"EEEE, d 'de' MMMM" : '' : 'pt-BR' | titlecase }}</p>
        <mat-chip-set>
          <mat-chip *ngIf="isHoje" class="chip-hoje">Hoje</mat-chip>
          <mat-chip *ngIf="somenteLeitura" class="chip-leitura">
            <mat-icon>lock</mat-icon> Somente leitura
          </mat-chip>
        </mat-chip-set>
      </div>

      <button mat-icon-button (click)="proximoDia()" matTooltip="Próximo dia">
        <mat-icon>chevron_right</mat-icon>
      </button>

      <button mat-button *ngIf="!isHoje" (click)="irParaHoje()" matTooltip="Voltar para hoje">
        <mat-icon>today</mat-icon> Hoje
      </button>
    </div>

    <mat-progress-bar *ngIf="loading" mode="indeterminate" class="loading-bar"></mat-progress-bar>
  </div>

  <div class="status-state folga" *ngIf="!loading && escalaHoje?.tipo === tipoEscalaEnum.FOLGA">
    <div class="icon-circle"><mat-icon>weekend</mat-icon></div>
    <h2>Bom descanso!</h2>
    <p>Folga neste dia.</p>
  </div>

  <div class="status-state ferias" *ngIf="!loading && escalaHoje?.tipo === tipoEscalaEnum.FERIAS">
    <div class="icon-circle"><mat-icon>beach_access</mat-icon></div>
    <h2>Boas Férias!</h2>
    <p>Divirta-se!</p>
  </div>

  <div class="status-state atestado" *ngIf="!loading && escalaHoje?.tipo === tipoEscalaEnum.ATESTADO">
    <div class="icon-circle"><mat-icon>medical_services</mat-icon></div>
    <h2>Afastamento</h2>
    <p>Cuide da sua saúde.</p>
  </div>

  <div class="empty-state" *ngIf="!loading && boards.length === 0 && (!escalaHoje || escalaHoje.tipo === tipoEscalaEnum.TRABALHO)">
    <img src="assets/images/relax.svg" alt="Sem Tarefas" style="width: 150px; opacity: 0.6; margin-bottom: 20px;">
    <h3>Tudo limpo por aqui!</h3>
    <p>Nenhuma checklist para este dia.</p>
  </div>

  <div class="kanban-container"
       cdkDropList
       cdkDropListOrientation="horizontal"
       (cdkDropListDropped)="dropBoard($event)"
       *ngIf="!loading && boards.length > 0 && (!escalaHoje || escalaHoje.tipo === tipoEscalaEnum.TRABALHO)">

    <div class="kanban-column" *ngFor="let board of boards" cdkDrag>

      <div class="custom-column-placeholder" *cdkDragPlaceholder></div>

      <div class="column-header">
        <div class="header-title">
          <mat-icon class="drag-handle" cdkDragHandle>drag_indicator</mat-icon>
          <h2>{{ board.nome }}</h2>
        </div>
        <span class="card-count">{{ board.cards.length }}</span>
      </div>

      <div class="cards-list"
           cdkDropList
           [id]="'cards-' + board.id"
           [cdkDropListData]="board.cards"
           [cdkDropListConnectedTo]="cardListIds"
           (cdkDropListDropped)="dropCard($event)">

        <div class="kanban-card"
             *ngFor="let card of board.cards"
             cdkDrag
             (click)="abrirCardDetalhado(card)"
             [class.card-concluido]="getProgresso(card) === 100"
             [class.card-fechado]="card.status === 'FECHADO' && getProgresso(card) < 100">

          <div class="custom-card-placeholder" *cdkDragPlaceholder></div>

          <div class="status-indicator"
               [ngClass]="card.status"
               [class.fechado-incompleto]="card.status === 'FECHADO' && getProgresso(card) < 100"></div>

          <div class="card-content">
            <div class="fechada-tag" *ngIf="card.status === 'FECHADO' && getProgresso(card) < 100">
              <mat-icon>lock</mat-icon> FECHADA
            </div>
            <h3 class="card-title">{{ card.titulo }}</h3>
            <div class="card-meta">
              <mat-icon class="clock-icon">schedule</mat-icon>
              <span>{{ card.horarioAbertura }} - {{ card.horarioFechamento }}</span>
            </div>
            <div class="card-badges">
              <div class="badge" *ngIf="card.descricao"><mat-icon>subject</mat-icon></div>
              <div class="badge" *ngIf="somenteLeitura" matTooltip="Somente leitura"><mat-icon>lock</mat-icon></div>
              <div class="badge checkbox-badge" [class.done]="getProgresso(card) === 100">
                <mat-icon>check_box</mat-icon>
                <span class="badge-text">{{ countMarcados(card) }}/{{ card.itens.length }}</span>
              </div>
            </div>
            <mat-progress-bar mode="determinate" [value]="getProgresso(card)" class="mini-progress"></mat-progress-bar>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
